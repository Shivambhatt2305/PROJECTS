<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediCare</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #e63946;
            --primary-dark: #c1121f;
            --primary-light: #f48c95;
            --secondary-color: #f1faee;
            --text-color: #1d3557;
            --accent-color: #457b9d;
            --light-bg: #f8f9fa;
            --dark-bg: #212529;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 10px 25px rgba(230, 57, 70, 0.2);
            --border-radius: 12px;
            --spacing-xs: 5px;
            --spacing-sm: 10px;
            --spacing-md: 15px;
            --spacing-lg: 20px;
            --spacing-xl: 30px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-lg);
            flex: 1;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            color: white;
            padding: var(--spacing-xl);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-xl);
            text-align: center;
            box-shadow: var(--card-shadow);
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
        }

        header h1 {
            font-size: 2.8rem;
            margin-bottom: var(--spacing-md);
            position: relative;
            display: inline-block;
        }

        header h1 i {
            margin-right: var(--spacing-md);
            animation: pulse 2s infinite;
        }

        header p {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        main {
            display: flex;
            gap: var(--spacing-xl);
            min-height: 600px;
        }

        .diseases-panel {
            flex: 0 0 350px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: var(--spacing-lg);
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            height: fit-content;
            max-height: 80vh;
            position: sticky;
            top: var(--spacing-lg);
        }

        .diseases-panel h2 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-lg);
            font-size: 1.8rem;
            border-bottom: 3px solid var(--primary-light);
            padding-bottom: var(--spacing-md);
            position: relative;
        }

        .diseases-panel h2::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 80px;
            height: 3px;
            background-color: var(--primary-color);
        }

        .search-box {
            margin-bottom: var(--spacing-md);
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid var(--secondary-color);
            border-radius: 30px;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-box input:focus {
            border-color: var(--primary-light);
        }

        .search-box i {
            position: absolute;
            right: var(--spacing-lg);
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary-color);
        }

        .disease-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            overflow-y: auto;
            padding-right: var(--spacing-sm);
            flex: 1;
        }

        .disease-list::-webkit-scrollbar {
            width: 8px;
        }

        .disease-list::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .disease-list::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }

        .disease-item {
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .disease-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--hover-shadow);
            border-left: 4px solid var(--primary-color);
        }

        .disease-item.active {
            background-color: var(--primary-light);
            color: white;
            border-left: 4px solid var(--primary-dark);
            box-shadow: var(--hover-shadow);
        }

        .disease-item i {
            font-size: 1.8rem;
            margin-right: var(--spacing-md);
            color: var(--primary-color);
            width: 40px;
            text-align: center;
        }

        .disease-item.active i {
            color: white;
        }

        .disease-item h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .disease-item p {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .content-panel {
            flex: 1;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .content-body {
            padding: var(--spacing-xl);
            overflow-y: auto;
            flex: 1;
        }

        .content-body::-webkit-scrollbar {
            width: 8px;
        }

        .content-body::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .content-body::-webkit-scrollbar-thumb {
            background: var(--primary-light);
            border-radius: 10px;
        }

        .content-section {
            margin-bottom: var(--spacing-xl);
            background-color: var(--light-bg);
            border-radius: var(--border-radius);
            padding: var(--spacing-xl);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .content-section h3 {
            color: var(--primary-color);
            font-size: 1.5rem;
            margin-bottom: var(--spacing-lg);
            display: flex;
            align-items: center;
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: var(--spacing-sm);
        }

        .content-section h3 i {
            margin-right: var(--spacing-md);
            font-size: 1.3rem;
        }

        .solutions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
        }

        .solution-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border-top: 4px solid var(--primary-color);
            height: 100%;
        }

        .solution-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .solution-card h4 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
        }

        .solution-card h4 i {
            margin-right: var(--spacing-sm);
            color: var(--primary-color);
        }

        .solution-card p {
            color: var(--text-color);
            line-height: 1.6;
        }

        .medicines-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .medicine-card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: var(--spacing-lg);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid var(--secondary-color);
            transition: all 0.3s ease;
            height: 100%;
        }

        .medicine-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            border-color: var(--primary-light);
        }

        .medicine-card h4 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }

        .medicine-card h4 span {
            background-color: var(--primary-light);
            color: white;
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 20px;
            margin-top: 5px;
        }

        .medicine-info {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .medicine-info p {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
        }

        .medicine-info p i {
            color: var(--primary-color);
            margin-right: var(--spacing-sm);
            width: 20px;
            flex-shrink: 0;
        }

        .doctors-section {
            margin-top: var(--spacing-xl);
        }

        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .doctor-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border: 1px solid var(--secondary-color);
            height: 100%;
        }

        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            border-color: var(--primary-light);
        }

        .doctor-image {
            height: 150px;
            background: linear-gradient(135deg, var(--primary-light) 0%, var(--primary-color) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .doctor-image i {
            font-size: 4rem;
            color: white;
        }

        .doctor-info {
            padding: var(--spacing-lg);
        }

        .doctor-info h4 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin-bottom: var(--spacing-sm);
        }

        .doctor-info p {
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: center;
            word-break: break-word;
        }

        .doctor-info p i {
            color: var(--primary-color);
            margin-right: var(--spacing-sm);
            width: 20px;
            flex-shrink: 0;
        }

        .doctor-info .rating {
            color: gold;
            font-size: 1.1rem;
            margin-top: var(--spacing-sm);
        }

        .medical-stores {
            margin-top: var(--spacing-xl);
        }

        .stores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: var(--spacing-lg);
        }

        .store-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            border: 1px solid var(--secondary-color);
            height: 100%;
            cursor: pointer;
        }

        .store-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
            border-color: var(--primary-light);
        }

        .store-header {
            background: linear-gradient(to right, var(--primary-light), var(--primary-color));
            color: white;
            padding: var(--spacing-md);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .store-header h4 {
            font-size: 1.2rem;
            word-break: break-word;
        }

        .store-header i {
            font-size: 1.5rem;
            flex-shrink: 0;
            margin-left: 10px;
        }

        .store-info {
            padding: var(--spacing-lg);
        }

        .store-info p {
            margin-bottom: var(--spacing-sm);
            display: flex;
            align-items: flex-start;
            word-break: break-word;
        }

        .store-info p i {
            color: var(--primary-color);
            margin-right: var(--spacing-sm);
            width: 20px;
            flex-shrink: 0;
            margin-top: 4px;
        }

        .store-info .distance {
            background-color: var(--secondary-color);
            padding: 8px 15px;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            margin-top: var(--spacing-sm);
        }

        .store-info .distance i {
            margin-right: 8px;
            margin-top: 0;
        }

        .map-container {
            margin-top: var(--spacing-xl);
            height: 400px;
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            display: none;
        }

        .map-container.active {
            display: block;
        }

        .map-placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--primary-color);
        }

        .map-placeholder i {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
        }

        .map-placeholder p {
            font-size: 1.2rem;
            text-align: center;
            padding: 0 20px;
        }

        .welcome-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: var(--spacing-xl);
            text-align: center;
        }

        .welcome-message i {
            font-size: 5rem;
            color: var(--primary-light);
            margin-bottom: var(--spacing-xl);
        }

        .welcome-message h2 {
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: var(--spacing-lg);
        }

        .welcome-message p {
            font-size: 1.2rem;
            max-width: 600px;
            line-height: 1.6;
            margin-bottom: var(--spacing-xl);
        }

        .welcome-message .arrow {
            color: var(--primary-color);
            font-size: 2rem;
            animation: bounceLeft 2s infinite;
            margin-top: var(--spacing-lg);
        }

        @keyframes bounceLeft {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(-20px); }
        }

        footer {
            background-color: var(--dark-bg);
            color: white;
            text-align: center;
            padding: var(--spacing-lg);
            margin-top: var(--spacing-xl);
            border-radius: var(--border-radius);
        }

        footer p {
            opacity: 0.8;
        }

        /* Loading animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
            padding: var(--spacing-xl);
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--secondary-color);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* No results message */
        .no-results {
            text-align: center;
            padding: var(--spacing-xl);
            color: var(--primary-color);
        }

        .no-results i {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }

        /* Location button */
        .location-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 10px 20px;
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-md);
            transition: all 0.3s ease;
        }

        .location-button:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .location-button i {
            margin-right: 10px;
        }

        .location-status {
            font-size: 0.9rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary-color);
            display: flex;
            align-items: center;
        }

        .location-status i {
            margin-right: 8px;
        }

        /* Location prompt */
        .location-prompt {
            text-align: center;
            padding: var(--spacing-xl);
            background-color: var(--secondary-color);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-lg);
        }

        .location-prompt i {
            font-size: 3rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }

        .location-prompt h4 {
            font-size: 1.5rem;
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
        }

        .location-prompt p {
            margin-bottom: var(--spacing-lg);
        }

        /* Mobile menu toggle */
        .mobile-menu-toggle {
            display: none;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            margin-bottom: var(--spacing-md);
            font-size: 1rem;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            width: 100%;
        }

        .mobile-menu-toggle i {
            margin-right: var(--spacing-sm);
        }

        /* Responsive styles - ENHANCED */
        @media (max-width: 1200px) {
            .container {
                padding: var(--spacing-md);
            }
            
            .solutions-grid,
            .medicines-list,
            .doctors-grid,
            .stores-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 992px) {
            main {
                flex-direction: column;
            }

            .diseases-panel {
                flex: 0 0 auto;
                width: 100%;
                max-width: 100%;
                position: static;
                max-height: none;
            }

            .disease-list {
                max-height: 400px;
            }
            
            .content-section {
                padding: var(--spacing-lg);
            }

            .mobile-menu-toggle {
                display: flex;
            }

            .diseases-panel {
                display: none;
                transition: all 0.3s ease;
            }

            .diseases-panel.active {
                display: flex;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-sm);
            }
            
            header {
                padding: var(--spacing-lg);
                margin-bottom: var(--spacing-lg);
            }
            
            header h1 {
                font-size: 2.2rem;
            }

            header p {
                font-size: 1.1rem;
            }
            
            .content-body {
                padding: var(--spacing-lg);
            }

            .content-section {
                padding: var(--spacing-md);
                margin-bottom: var(--spacing-lg);
            }
            
            .solutions-grid,
            .medicines-list,
            .doctors-grid,
            .stores-grid {
                grid-template-columns: 1fr;
                gap: var(--spacing-md);
            }
            
            .welcome-message h2 {
                font-size: 2rem;
            }
            
            .welcome-message p {
                font-size: 1rem;
            }

            .welcome-message .arrow {
                transform: rotate(90deg);
                animation: bounceUp 2s infinite;
            }

            @keyframes bounceUp {
                0%, 100% { transform: translateY(0) rotate(90deg); }
                50% { transform: translateY(-20px) rotate(90deg); }
            }
        }

        @media (max-width: 576px) {
            .container {
                padding: var(--spacing-xs);
            }
            
            header h1 {
                font-size: 1.8rem;
            }
            
            .diseases-panel {
                padding: var(--spacing-md);
            }
            
            .diseases-panel h2 {
                font-size: 1.5rem;
            }
            
            .disease-item {
                padding: var(--spacing-sm);
            }
            
            .disease-item i {
                font-size: 1.5rem;
                width: 30px;
            }
            
            .disease-item h3 {
                font-size: 1rem;
            }
            
            .content-body {
                padding: var(--spacing-md);
            }
            
            .content-section h3 {
                font-size: 1.3rem;
            }
            
            .solution-card,
            .medicine-card,
            .doctor-card,
            .store-card {
                padding: var(--spacing-md);
            }
            
            .doctor-image {
                height: 120px;
            }
            
            .doctor-image i {
                font-size: 3rem;
            }
            
            .map-container {
                height: 300px;
            }

            .location-prompt {
                padding: var(--spacing-md);
            }

            .location-prompt h4 {
                font-size: 1.3rem;
            }

            .location-prompt i {
                font-size: 2.5rem;
            }
        }

        /* Print styles */
        @media print {
            .diseases-panel, footer, .map-container, .mobile-menu-toggle {
                display: none;
            }

            .content-panel {
                box-shadow: none;
            }

            .content-body {
                padding: 0;
            }

            .solution-card, .medicine-card, .doctor-card, .store-card {
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }

        .store-card.active-store {
            border: 2px solid var(--primary-color);
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        /* Improved touch targets for mobile */
        @media (max-width: 768px) {
            .disease-item, 
            .solution-card,
            .medicine-card,
            .doctor-card,
            .store-card,
            .location-button {
                padding: var(--spacing-lg);
            }

            .search-box input {
                height: 50px;
                font-size: 16px; /* Prevents iOS zoom on focus */
            }

            .disease-item i {
                font-size: 2rem;
                width: 40px;
            }
        }

        /* Fix for iOS Safari 100vh issue */
        @supports (-webkit-touch-callout: none) {
            .diseases-panel {
                max-height: 70vh;
            }
        }

        /* Orientation specific styles */
        @media (max-width: 992px) and (orientation: landscape) {
            .disease-list {
                max-height: 200px;
            }

            .solutions-grid,
            .medicines-list,
            .doctors-grid,
            .stores-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-heartbeat"></i> MediCare</h1>
            <!-- <p>Your personal health assistant for medicine suggestions and healthcare guidance</p> -->
        </header>

        <button id="mobileMenuToggle" class="mobile-menu-toggle">
            <i class="fas fa-list-ul"></i> Show Disease List
        </button>

        <main>
            <div class="diseases-panel" id="diseasesPanel">
                <h2>Common Diseases</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Search diseases...">
                    <i class="fas fa-search"></i>
                </div>
                <div class="disease-list" id="diseaseList">
                    <!-- Disease items will be loaded here -->
                    <div class="loading">
                        <div class="loading-spinner"></div>
                    </div>
                </div>
            </div>

            <div class="content-panel">
                <div id="welcomeScreen" class="welcome-message">
                    <i class="fas fa-hand-holding-medical"></i>
                    <h2>Welcome to MediGuide</h2>
                    <p>Select a disease from the list to view recommended solutions, medicines, and healthcare providers.</p>
                    <div class="arrow">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                </div>

                <div id="diseaseContent" style="display: none; height: 100%;">
                    <div class="content-body">
                        <div class="content-section">
                            <h3><i class="fas fa-check-circle"></i> Recommended Solutions</h3>
                            <div id="solutionsContainer">
                                <div class="solutions-grid" id="solutionsGrid">
                                    <!-- Solution cards will be loaded here -->
                                    <div class="loading">
                                        <div class="loading-spinner"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="content-section">
                            <h3><i class="fas fa-pills"></i> Recommended Medicines</h3>
                            <div id="medicinesContainer">
                                <div class="medicines-list" id="medicinesList">
                                    <!-- Medicine cards will be loaded here -->
                                    <div class="loading">
                                        <div class="loading-spinner"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="content-section doctors-section">
                            <h3><i class="fas fa-user-md"></i> Recommended Doctors</h3>
                            <div id="doctorsContainer">
                                <div class="doctors-grid" id="doctorsGrid">
                                    <!-- Doctor cards will be loaded here -->
                                    <div class="loading">
                                        <div class="loading-spinner"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="content-section medical-stores">
                            <h3><i class="fas fa-clinic-medical"></i> Nearby Medical Stores</h3>
                            <div class="location-prompt" id="locationPrompt">
                                <i class="fas fa-map-marker-alt"></i>
                                <h4>Find Pharmacies Near You</h4>
                                <p>Share your location to discover medical stores in your area that have the medicines you need.</p>
                                <button id="getLocationBtn" class="location-button">
                                    <i class="fas fa-location-arrow"></i> Share My Location
                                </button>
                            </div>
                            <div id="locationStatus" class="location-status" style="display: none;">
                                <i class="fas fa-spinner fa-spin"></i> Getting your location...
                            </div>
                            <div id="storesContainer">
                                <div class="stores-grid" id="storesGrid">
                                    <!-- Store cards will be loaded here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="map-container" id="mapContainer">
                            <div class="map-placeholder">
                                <i class="fas fa-map-marked-alt"></i>
                                <p>Map will be displayed here when you select a medical store.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <p>&copy; 2025 MediCare - Your Health Companion</p>
        </footer>
    </div>

    <script>
        // TomTom Maps API key
        const TOMTOM_API_KEY = 'mWLsr3vkMx0bsUbZeXKffiJtyTJGxFG3';
        
        // User location variables
        let userLat = null;
        let userLon = null;
        
        // Static data for diseases
        const diseases = [
            { id: 1, name: "Fever", icon: "fa-thermometer-full", description: "An abnormal increase in body temperature, often a sign that your body is fighting an infection." },
            { id: 2, name: "Cough", icon: "fa-head-side-cough", description: "A sudden expulsion of air from the lungs that helps clear the lung airways of  description: \"A sudden expulsion of air from the lungs that helps clear the lung airways of fluids, mucus, or material.\"" },
            { id: 3, name: "Headache", icon: "fa-head-side-virus", description: "Pain in any region of the head. Headaches may occur on one or both sides of the head, be isolated to a certain location, or radiate across the head." },
            { id: 4, name: "Common Cold", icon: "fa-virus", description: "A viral infectious disease of the upper respiratory tract that primarily affects the nose and throat." },
            { id: 5, name: "Allergies", icon: "fa-lungs-virus", description: "An abnormal immune response to substances (allergens) that are typically harmless to most people." },
            { id: 6, name: "Hypertension", icon: "fa-heart-pulse", description: "A condition in which the force of the blood against the artery walls is too high, often called the 'silent killer'." },
            { id: 7, name: "Diabetes", icon: "fa-syringe", description: "A metabolic disease that causes high blood sugar due to problems with insulin production or function." }
        ];

        // Sample medicines data
        const medicinesData = {
            1: [ // Fever
                { id: 1, name: "Acetaminophen", type: "Analgesic", dosage: "500-1000mg", frequency: "Every 4-6 hours", side_effects: "Rare at recommended doses" },
                { id: 2, name: "Ibuprofen", type: "NSAID", dosage: "200-400mg", frequency: "Every 4-6 hours", side_effects: "Stomach upset, heartburn" },
                { id: 3, name: "Aspirin", type: "NSAID", dosage: "325-650mg", frequency: "Every 4 hours", side_effects: "Stomach irritation, increased bleeding risk" }
            ],
            2: [ // Cough
                { id: 4, name: "Dextromethorphan", type: "Cough Suppressant", dosage: "10-20mg", frequency: "Every 4 hours", side_effects: "Drowsiness, dizziness" },
                { id: 5, name: "Guaifenesin", type: "Expectorant", dosage: "200-400mg", frequency: "Every 4 hours", side_effects: "Nausea, stomach pain" },
                { id: 6, name: "Benzonatate", type: "Antitussive", dosage: "100-200mg", frequency: "Three times daily", side_effects: "Headache, drowsiness, dizziness" }
            ],
            3: [ // Headache
                { id: 7, name: "Acetaminophen", type: "Analgesic", dosage: "500-1000mg", frequency: "Every 4-6 hours", side_effects: "Rare at recommended doses" },
                { id: 8, name: "Ibuprofen", type: "NSAID", dosage: "200-400mg", frequency: "Every 4-6 hours", side_effects: "Stomach upset, heartburn" },
                { id: 9, name: "Naproxen", type: "NSAID", dosage: "220-440mg", frequency: "Every 8-12 hours", side_effects: "Stomach upset, heartburn, dizziness" }
            ],
            4: [ // Common Cold
                { id: 10, name: "Phenylephrine", type: "Decongestant", dosage: "10mg", frequency: "Every 4 hours", side_effects: "Nervousness, dizziness, increased blood pressure" },
                { id: 11, name: "Loratadine", type: "Antihistamine", dosage: "10mg", frequency: "Once daily", side_effects: "Drowsiness, dry mouth" },
                { id: 12, name: "Zinc Lozenges", type: "Supplement", dosage: "10-15mg", frequency: "Every 2 hours", side_effects: "Nausea, bad taste" }
            ],
            5: [ // Allergies
                { id: 13, name: "Cetirizine", type: "Antihistamine", dosage: "5-10mg", frequency: "Once daily", side_effects: "Drowsiness, dry mouth" },
                { id: 14, name: "Fexofenadine", type: "Antihistamine", dosage: "60-180mg", frequency: "Once daily", side_effects: "Headache, back pain" },
                { id: 15, name: "Fluticasone", type: "Nasal Steroid", dosage: "1-2 sprays per nostril", frequency: "Once daily", side_effects: "Nasal irritation, headache" }
            ],
            6: [ // Hypertension
                { id: 16, name: "Lisinopril", type: "ACE Inhibitor", dosage: "10-40mg", frequency: "Once daily", side_effects: "Dry cough, dizziness" },
                { id: 17, name: "Amlodipine", type: "Calcium Channel Blocker", dosage: "5-10mg", frequency: "Once daily", side_effects: "Swelling, flushing" },
                { id: 18, name: "Hydrochlorothiazide", type: "Diuretic", dosage: "12.5-25mg", frequency: "Once daily", side_effects: "Increased urination, electrolyte imbalance" }
            ],
            7: [ // Diabetes
                { id: 19, name: "Metformin", type: "Biguanide", dosage: "500-1000mg", frequency: "Twice daily", side_effects: "Nausea, diarrhea, stomach upset" },
                { id: 20, name: "Glipizide", type: "Sulfonylurea", dosage: "5-10mg", frequency: "Once daily", side_effects: "Hypoglycemia, weight gain" },
                { id: 21, name: "Insulin", type: "Hormone", dosage: "Varies", frequency: "As directed", side_effects: "Hypoglycemia, weight gain, injection site reactions" }
            ]
        };

        // Sample doctors data
        const doctorsData = {
            1: [ // Fever
                { id: 1, name: "Dr. Sarah Johnson", specialty: "General Physician", contact: "+1 (555) 111-2222", rating: 4.8 },
                { id: 2, name: "Dr. Michael Chen", specialty: "Internal Medicine", contact: "+1 (555) 333-4444", rating: 4.5 },
                { id: 3, name: "Dr. Emily Rodriguez", specialty: "Family Medicine", contact: "+1 (555) 555-6666", rating: 4.7 }
            ],
            2: [ // Cough
                { id: 4, name: "Dr. Robert Williams", specialty: "Pulmonologist", contact: "+1 (555) 777-8888", rating: 4.9 },
                { id: 5, name: "Dr. Lisa Thompson", specialty: "General Physician", contact: "+1 (555) 999-0000", rating: 4.6 },
                { id: 6, name: "Dr. David Kim", specialty: "ENT Specialist", contact: "+1 (555) 123-7890", rating: 4.8 }
            ],
            3: [ // Headache
                { id: 7, name: "Dr. Jennifer Lee", specialty: "Neurologist", contact: "+1 (555) 456-7891", rating: 4.9 },
                { id: 8, name: "Dr. Thomas Brown", specialty: "Pain Management", contact: "+1 (555) 234-5678", rating: 4.7 },
                { id: 9, name: "Dr. Amanda Clark", specialty: "General Physician", contact: "+1 (555) 890-1234", rating: 4.5 }
            ],
            4: [ // Common Cold
                { id: 10, name: "Dr. James Wilson", specialty: "Family Medicine", contact: "+1 (555) 345-6789", rating: 4.6 },
                { id: 11, name: "Dr. Patricia Moore", specialty: "General Physician", contact: "+1 (555) 678-9012", rating: 4.4 },
                { id: 12, name: "Dr. Kevin Taylor", specialty: "ENT Specialist", contact: "+1 (555) 901-2345", rating: 4.8 }
            ],
            5: [ // Allergies
                { id: 13, name: "Dr. Susan Martinez", specialty: "Allergist", contact: "+1 (555) 432-1098", rating: 4.9 },
                { id: 14, name: "Dr. Richard White", specialty: "Immunologist", contact: "+1 (555) 765-4321", rating: 4.7 },
                { id: 15, name: "Dr. Nancy Garcia", specialty: "Pulmonologist", contact: "+1 (555) 098-7654", rating: 4.6 }
            ],
            6: [ // Hypertension
                { id: 16, name: "Dr. Charles Davis", specialty: "Cardiologist", contact: "+1 (555) 321-6547", rating: 4.9 },
                { id: 17, name: "Dr. Elizabeth Smith", specialty: "Internal Medicine", contact: "+1 (555) 654-9870", rating: 4.7 },
                { id: 18, name: "Dr. Daniel Johnson", specialty: "Nephrologist", contact: "+1 (555) 987-6541", rating: 4.8 }
            ],
            7: [ // Diabetes
                { id: 19, name: "Dr. Margaret Lewis", specialty: "Endocrinologist", contact: "+1 (555) 147-2583", rating: 4.9 },
                { id: 20, name: "Dr. Joseph Harris", specialty: "Internal Medicine", contact: "+1 (555) 369-1470", rating: 4.6 },
                { id: 21, name: "Dr. Barbara Martin", specialty: "Diabetologist", contact: "+1 (555) 258-1470", rating: 4.8 }
            ]
        };

        // Sample solutions data
        const solutionsData = {
            1: [ // Fever
                { title: "Rest and Hydration", description: "Get plenty of rest and drink fluids to stay hydrated. This helps your body fight the infection causing the fever." },
                { title: "Cool Compress", description: "Apply a cool, damp washcloth to your forehead or wrists to help reduce body temperature." },
                { title: "Light Clothing", description: "Wear lightweight clothing and use light blankets to avoid overheating." }
            ],
            2: [ // Cough
                { title: "Stay Hydrated", description: "Drink plenty of fluids to thin mucus and soothe an irritated throat." },
                { title: "Honey and Warm Water", description: "Mix honey with warm water or tea to soothe throat irritation (not for children under 1 year)." },
                { title: "Humidifier", description: "Use a humidifier to add moisture to the air, which can help ease coughing." }
            ],
            3: [ // Headache
                { title: "Rest in a Dark Room", description: "Lie down in a quiet, dark room to reduce sensory stimulation that can worsen headaches." },
                { title: "Cold or Warm Compress", description: "Apply a cold or warm compress to your forehead or neck, depending on what provides relief." },
                { title: "Hydration", description: "Drink plenty of water as dehydration can trigger or worsen headaches." }
            ],
            4: [ // Common Cold
                { title: "Rest", description: "Get plenty of sleep to help your body fight the infection." },
                { title: "Hydration", description: "Drink plenty of fluids like water, juice, and clear broth to prevent dehydration." },
                { title: "Gargle Salt Water", description: "Gargle with salt water to relieve a sore or scratchy throat." }
            ],
            5: [ // Allergies
                { title: "Identify Triggers", description: "Try to identify and avoid allergens that trigger your symptoms." },
                { title: "Air Purifiers", description: "Use HEPA air purifiers to reduce airborne allergens in your home." },
                { title: "Nasal Irrigation", description: "Use a saline nasal rinse to flush out allergens from your nasal passages." }
            ],
            6: [ // Hypertension
                { title: "Reduce Sodium", description: "Limit salt intake to help lower blood pressure." },
                { title: "Regular Exercise", description: "Engage in regular physical activity, at least 30 minutes most days of the week." },
                { title: "Stress Management", description: "Practice stress-reduction techniques like meditation, deep breathing, or yoga." }
            ],
            7: [ // Diabetes
                { title: "Balanced Diet", description: "Follow a balanced diet rich in fruits, vegetables, and whole grains while limiting refined carbs." },
                { title: "Regular Exercise", description: "Engage in regular physical activity to help control blood sugar levels." },
                { title: "Monitor Blood Sugar", description: "Regularly check your blood sugar levels as recommended by your healthcare provider." }
            ]
        };

        // DOM elements
        const diseaseList = document.getElementById('diseaseList');
        const searchInput = document.getElementById('searchInput');
        const welcomeScreen = document.getElementById('welcomeScreen');
        const diseaseContent = document.getElementById('diseaseContent');
        const solutionsGrid = document.getElementById('solutionsGrid');
        const medicinesList = document.getElementById('medicinesList');
        const doctorsGrid = document.getElementById('doctorsGrid');
        const storesGrid = document.getElementById('storesGrid');
        const mapContainer = document.getElementById('mapContainer');
        const solutionsContainer = document.getElementById('solutionsContainer');
        const medicinesContainer = document.getElementById('medicinesContainer');
        const doctorsContainer = document.getElementById('doctorsContainer');
        const storesContainer = document.getElementById('storesContainer');
        const getLocationBtn = document.getElementById('getLocationBtn');
        const locationStatus = document.getElementById('locationStatus');
        const locationPrompt = document.getElementById('locationPrompt');
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const diseasesPanel = document.getElementById('diseasesPanel');

        // Initialize the page
        function initPage() {
            loadDiseases();
            setupEventListeners();
        }

        // Load diseases into the list
        function loadDiseases() {
            diseaseList.innerHTML = '';
            
            if (diseases.length === 0) {
                diseaseList.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>No diseases found in the database.</p>
                    </div>
                `;
                return;
            }
            
            diseases.forEach(disease => {
                const diseaseItem = document.createElement('div');
                diseaseItem.className = 'disease-item';
                diseaseItem.dataset.id = disease.id;
                
                // Set default icon if not provided
                const icon = disease.icon || 'fa-virus';
                
                diseaseItem.innerHTML = `
                    <i class="fas ${icon}"></i>
                    <div>
                        <h3>${disease.name}</h3>
                        <p>Common condition</p>
                    </div>
                `;
                
                diseaseItem.addEventListener('click', () => {
                    // Remove active class from all items
                    document.querySelectorAll('.disease-item').forEach(item => {
                        item.classList.remove('active');
                    });
                    
                    // Add active class to clicked item
                    diseaseItem.classList.add('active');
                    
                    // Load disease details
                    loadDiseaseDetails(disease.id);
                    
                    // On mobile, hide the diseases panel after selection
                    if (window.innerWidth <= 992) {
                        diseasesPanel.classList.remove('active');
                        mobileMenuToggle.innerHTML = '<i class="fas fa-list-ul"></i> Show Disease List';
                    }
                });
                
                diseaseList.appendChild(diseaseItem);
            });
        }

        // Set up event listeners
        function setupEventListeners() {
            // Search functionality
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                filterDiseases(searchTerm);
            });

            // Location button click
            getLocationBtn.addEventListener('click', getUserLocation);
            
            // Mobile menu toggle
            mobileMenuToggle.addEventListener('click', function() {
                diseasesPanel.classList.toggle('active');
                if (diseasesPanel.classList.contains('active')) {
                    this.innerHTML = '<i class="fas fa-times"></i> Hide Disease List';
                } else {
                    this.innerHTML = '<i class="fas fa-list-ul"></i> Show Disease List';
                }
            });
            
            // Handle window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth > 992) {
                    diseasesPanel.classList.remove('active');
                }
            });
        }

        // Filter diseases based on search term
        function filterDiseases(searchTerm) {
            const diseaseItems = diseaseList.querySelectorAll('.disease-item');
            let hasResults = false;
            
            diseaseItems.forEach(item => {
                const diseaseName = item.querySelector('h3').textContent.toLowerCase();
                if (diseaseName.includes(searchTerm)) {
                    item.style.display = 'flex';
                    hasResults = true;
                } else {
                    item.style.display = 'none';
                }
            });
            
            // Show no results message if needed
            if (!hasResults && searchTerm !== '') {
                if (!document.querySelector('.no-results')) {
                    const noResults = document.createElement('div');
                    noResults.className = 'no-results';
                    noResults.innerHTML = `
                        <i class="fas fa-search"></i>
                        <p>No diseases found matching "${searchTerm}"</p>
                    `;
                    diseaseList.appendChild(noResults);
                }
            } else {
                const noResults = document.querySelector('.no-results');
                if (noResults) {
                    noResults.remove();
                }
            }
        }

        // Load disease details
        function loadDiseaseDetails(diseaseId) {
            // Show loading state
            welcomeScreen.style.display = 'none';
            diseaseContent.style.display = 'flex';
            
            // Show loading spinners
            solutionsGrid.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            medicinesList.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            doctorsGrid.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            // Find the disease by ID
            const disease = diseases.find(d => d.id == diseaseId);
            
            if (disease) {
                // Load solutions
                loadSolutions(diseaseId);
                
                // Load medicines
                displayMedicines(medicinesData[diseaseId] || []);
                
                // Load doctors
                displayDoctors(doctorsData[diseaseId] || []);
                
                // Reset stores section - show location prompt
                locationPrompt.style.display = 'block';
                storesGrid.innerHTML = '';
                mapContainer.classList.remove('active');
            }
        }

        // Load solutions for the selected disease
        function loadSolutions(diseaseId) {
            const solutions = solutionsData[diseaseId] || [];
            
            if (solutions.length === 0) {
                solutionsGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>No solutions available for this condition.</p>
                    </div>
                `;
                return;
            }
            
            solutionsGrid.innerHTML = '';
            
            solutions.forEach(solution => {
                const solutionCard = document.createElement('div');
                solutionCard.className = 'solution-card';
                
                solutionCard.innerHTML = `
                    <h4><i class="fas fa-check-circle"></i> ${solution.title}</h4>
                    <p>${solution.description}</p>
                `;
                
                solutionsGrid.appendChild(solutionCard);
            });
        }

        // Display medicines
        function displayMedicines(medicines) {
            if (medicines.length === 0) {
                medicinesList.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>No medicines available for this condition.</p>
                    </div>
                `;
                return;
            }
            
            medicinesList.innerHTML = '';
            
            medicines.forEach(medicine => {
                const medicineCard = document.createElement('div');
                medicineCard.className = 'medicine-card';
                
                // Set default values if not provided
                const dosage = medicine.dosage || 'As directed';
                const frequency = medicine.frequency || 'As needed';
                const type = medicine.type || 'Medication';
                
                medicineCard.innerHTML = `
                    <h4>${medicine.name} <span>${type}</span></h4>
                    <div class="medicine-info">
                        <p><i class="fas fa-prescription"></i> <strong>Dosage:</strong> ${dosage}</p>
                        <p><i class="fas fa-clock"></i> <strong>Frequency:</strong> ${frequency}</p>
                        ${medicine.side_effects ? `<p><i class="fas fa-exclamation-triangle"></i> <strong>Side Effects:</strong> ${medicine.side_effects}</p>` : ''}
                    </div>
                `;
                
                medicinesList.appendChild(medicineCard);
            });
        }

        // Display doctors
        function displayDoctors(doctors) {
            if (doctors.length === 0) {
                doctorsGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>No doctors available for this condition.</p>
                    </div>
                `;
                return;
            }
            
            doctorsGrid.innerHTML = '';
            
            doctors.forEach(doctor => {
                const doctorCard = document.createElement('div');
                doctorCard.className = 'doctor-card';
                
                // Set default rating if not provided
                const rating = doctor.rating || 4.0;
                
                doctorCard.innerHTML = `
                    <div class="doctor-image">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="doctor-info">
                        <h4>${doctor.name}</h4>
                        <p><i class="fas fa-stethoscope"></i> ${doctor.specialty || 'Specialist'}</p>
                        <p><i class="fas fa-phone"></i> ${doctor.contact || 'Contact not available'}</p>
                        <div class="rating">
                            ${''.repeat(Math.floor(rating))}${''.repeat(5 - Math.floor(rating))}
                            <span>(${rating})</span>
                        </div>
                    </div>
                `;
                
                doctorsGrid.appendChild(doctorCard);
            });
        }

        // Get user's current location
        function getUserLocation() {
            if (!navigator.geolocation) {
                alert("Geolocation is not supported by your browser");
                return;
            }
            
            // Show loading status
            locationStatus.style.display = 'flex';
            locationStatus.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Getting your location...';
            
            navigator.geolocation.getCurrentPosition(
                // Success callback
                position => {
                    userLat = position.coords.latitude;
                    userLon = position.coords.longitude;
                    
                    locationStatus.innerHTML = '<i class="fas fa-check-circle"></i> Location found! Searching for nearby pharmacies...';
                    
                    // Hide location prompt
                    locationPrompt.style.display = 'none';
                    
                    // Fetch nearby pharmacies
                    fetchNearbyPharmacies(userLat, userLon);
                },
                // Error callback
                error => {
                    locationStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Unable to retrieve your location. Please try again.';
                    console.error("Error getting location:", error);
                    
                    // Hide status after 3 seconds
                    setTimeout(() => {
                        locationStatus.style.display = 'none';
                    }, 3000);
                },
                // Options
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // Fetch nearby pharmacies using API
        function fetchNearbyPharmacies(lat, lon) {
            // Show loading state
            storesGrid.innerHTML = '<div class="loading"><div class="loading-spinner"></div></div>';
            
            // Use the TomTom API to search for pharmacies
            const apiUrl = `https://api.tomtom.com/search/2/search/pharmacy.json?key=${TOMTOM_API_KEY}&lat=${lat}&lon=${lon}&radius=10000&limit=10`;
            
            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Process the pharmacy data
                    const pharmacies = processPharmacyData(data, lat, lon);
                    
                    if (pharmacies.length > 0) {
                        displayStores(pharmacies);
                        
                        // Update status
                        locationStatus.innerHTML = '<i class="fas fa-check-circle"></i> Found ' + pharmacies.length + ' pharmacies near you!';
                    } else {
                        // No pharmacies found
                        storesGrid.innerHTML = `
                            <div class="no-results">
                                <i class="fas fa-exclamation-circle"></i>
                                <p>No pharmacies found in your area. Try expanding your search radius.</p>
                            </div>
                        `;
                        
                        locationStatus.innerHTML = '<i class="fas fa-info-circle"></i> No pharmacies found in your area.';
                    }
                    
                    // Hide status after 3 seconds
                    setTimeout(() => {
                        locationStatus.style.display = 'none';
                    }, 3000);
                })
                .catch(error => {
                    console.error('Error fetching pharmacy data:', error);
                    
                    // Show error message
                    storesGrid.innerHTML = `
                        <div class="no-results">
                            <i class="fas fa-exclamation-triangle"></i>
                            <p>Unable to fetch pharmacy data. Please try again later.</p>
                            <button id="retryLocationBtn" class="location-button" style="margin-top: 15px;">
                                <i class="fas fa-redo"></i> Retry
                            </button>
                        </div>
                    `;
                    
                    // Add retry button functionality
                    document.getElementById('retryLocationBtn').addEventListener('click', () => {
                        getUserLocation();
                    });
                    
                    locationStatus.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error fetching pharmacy data.';
                    
                    // Hide status after 3 seconds
                    setTimeout(() => {
                        locationStatus.style.display = 'none';
                    }, 3000);
                });
        }

        // Process pharmacy data from API response
        function processPharmacyData(data, userLat, userLon) {
            const pharmacies = [];
            
            if (data && data.results && data.results.length > 0) {
                data.results.forEach((result, index) => {
                    // Calculate distance between user and pharmacy
                    const distance = calculateDistance(
                        userLat, 
                        userLon, 
                        result.position.lat, 
                        result.position.lon
                    );
                    
                    const pharmacy = {
                        id: index + 1,
                        name: result.poi ? result.poi.name : 'Pharmacy ' + (index + 1),
                        address: result.address ? result.address.freeformAddress : 'Address not available',
                        contact: result.poi && result.poi.phone ? result.poi.phone : 'Contact not available',
                        distance: distance.toFixed(1) + ' miles',
                        lat: result.position.lat,
                        lon: result.position.lon
                    };
                    
                    pharmacies.push(pharmacy);
                });
                
                // Sort pharmacies by distance
                pharmacies.sort((a, b) => {
                    const distA = parseFloat(a.distance);
                    const distB = parseFloat(b.distance);
                    return distA - distB;
                });
            }
            
            return pharmacies;
        }

        // Calculate distance between two coordinates using Haversine formula
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 3958.8; // Earth's radius in miles
            const dLat = toRadians(lat2 - lat1);
            const dLon = toRadians(lon2 - lon1);
            
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) * 
                Math.sin(dLon/2) * Math.sin(dLon/2);
            
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            
            return distance;
        }

        // Convert degrees to radians
        function toRadians(degrees) {
            return degrees * (Math.PI/180);
        }

        // Display medical stores
        function displayStores(stores) {
            if (stores.length === 0) {
                storesGrid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>No medical stores found in your area.</p>
                    </div>
                `;
                return;
            }
            
            storesGrid.innerHTML = '';
            
            stores.forEach(store => {
                const storeCard = document.createElement('div');
                storeCard.className = 'store-card';
                
                storeCard.innerHTML = `
                    <div class="store-header">
                        <h4>${store.name}</h4>
                        <i class="fas fa-clinic-medical"></i>
                    </div>
                    <div class="store-info">
                        <p><i class="fas fa-map-marker-alt"></i> ${store.address || 'Address not available'}</p>
                        <p><i class="fas fa-phone"></i> ${store.contact || 'Contact not available'}</p>
                        <div class="distance">
                            <i class="fas fa-walking"></i> ${store.distance}
                        </div>
                    </div>
                `;
                
                storeCard.addEventListener('click', () => {
                    // Clear any previous active state
                    document.querySelectorAll('.store-card').forEach(card => {
                        card.classList.remove('active-store');
                    });
                    
                    // Add active state to clicked store
                    storeCard.classList.add('active-store');
                    
                    // Show this specific store on the map
                    showMap(store);
                });
                
                storesGrid.appendChild(storeCard);
            });
        }

        // Modify showMap function to use TomTom Maps
        function showMap(store) {
            mapContainer.classList.add('active');
            
            // Create map container with loading indicator
            mapContainer.innerHTML = `
                <div id="tomtom-map" style="width: 100%; height: 100%;">
                    <div style="display: flex; justify-content: center; align-items: center; height: 100%;">
                        <div class="loading-spinner"></div>
                        <p style="margin-left: 15px;">Loading map for ${store.name}...</p>
                    </div>
                </div>`;
            
            // Check if store has coordinates
            if (!store.lat || !store.lon) {
                // Display error message if coordinates are missing
                document.getElementById('tomtom-map').innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <p>Sorry, map coordinates are not available for ${store.name}.</p>
                    </div>
                `;
                return;
            }
            
            // Load TomTom Maps CSS
            if (!document.getElementById('tomtom-css')) {
                const mapCSS = document.createElement('link');
                mapCSS.id = 'tomtom-css';
                mapCSS.rel = 'stylesheet';
                mapCSS.href = 'https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/maps/maps.css';
                document.head.appendChild(mapCSS);
            }
            
            // Check if TomTom is already loaded
            if (window.tt) {
                initializeMap(store);
            } else {
                // Load TomTom Maps script dynamically
                const mapScript = document.createElement('script');
                mapScript.src = `https://api.tomtom.com/maps-sdk-for-web/cdn/6.x/6.23.0/maps/maps-web.min.js`;
                mapScript.onload = () => {
                    initializeMap(store);
                };
                document.body.appendChild(mapScript);
            }
            
            // Scroll to map
            mapContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Add a new function to initialize the map
        function initializeMap(store) {
            // Initialize TomTom Map
            const map = window.tt.map({
                key: TOMTOM_API_KEY,
                container: 'tomtom-map',
                center: [store.lon, store.lat],
                zoom: 15
            });

            // Add marker for the store
            const marker = new window.tt.Marker()
                .setLngLat([store.lon, store.lat])
                .addTo(map);

            // Add popup with store details
            const popup = new window.tt.Popup({ offset: 35 })
                .setHTML(`
                    <h4>${store.name}</h4>
                    <p>${store.address}</p>
                    <p>Contact: ${store.contact}</p>
                    <p>Distance: ${store.distance}</p>
                `);

            marker.setPopup(popup);
            
            // If user location is available, add user marker and route
            if (userLat && userLon) {
                // Add user location marker
                const userMarker = new window.tt.Marker({ color: '#e63946' })
                    .setLngLat([userLon, userLat])
                    .addTo(map);
                
                // Add user location popup
                const userPopup = new window.tt.Popup({ offset: 35 })
                    .setHTML(`
                        <h4>Your Location</h4>
                        <p>This is your current position</p>
                    `);
                
                userMarker.setPopup(userPopup);
                
                // Adjust map bounds to show both markers
                const bounds = new window.tt.LngLatBounds();
                bounds.extend([store.lon, store.lat]);
                bounds.extend([userLon, userLat]);
                
                map.fitBounds(bounds, { padding: 100 });
                
                // Calculate and display route if within reasonable distance
                const storeDistance = parseFloat(store.distance);
                if (storeDistance < 20) { // Only show route if less than 20 miles
                    calculateRoute(map, [userLon, userLat], [store.lon, store.lat]);
                }
            }
        }
        
        // Calculate and display route between two points
        function calculateRoute(map, start, end) {
            // Create route URL
            const routeUrl = `https://api.tomtom.com/routing/1/calculateRoute/${start[1]},${start[0]}:${end[1]},${end[0]}/json?key=${TOMTOM_API_KEY}&traffic=false`;
            
            // Fetch route data
            fetch(routeUrl)
                .then(response => response.json())
                .then(data => {
                    if (data && data.routes && data.routes.length > 0) {
                        const routeGeoJson = {
                            type: 'FeatureCollection',
                            features: [
                                {
                                    type: 'Feature',
                                    geometry: {
                                        type: 'LineString',
                                        coordinates: data.routes[0].legs[0].points.map(point => [point.longitude, point.latitude])
                                    },
                                    properties: {}
                                }
                            ]
                        };
                        
                        // Add route to map
                        if (map.getSource('route')) {
                            map.getSource('route').setData(routeGeoJson);
                        } else {
                            map.addSource('route', {
                                type: 'geojson',
                                data: routeGeoJson
                            });
                            
                            map.addLayer({
                                id: 'route',
                                type: 'line',
                                source: 'route',
                                layout: {
                                    'line-join': 'round',
                                    'line-cap': 'round'
                                },
                                paint: {
                                    'line-color': '#e63946',
                                    'line-width': 4,
                                    'line-opacity': 0.8
                                }
                            });
                        }
                    }
                })
                .catch(error => {
                    console.error('Error calculating route:', error);
                });
        }

        // Initialize the page when the DOM is loaded
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>
